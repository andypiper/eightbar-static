<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Even More MQTT enabled TVs | eightbar</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="https://eightbar.eu-gb.mybluemix.net/wp-content/themes/twentyeleven/style.css" />
<link rel="pingback" href="https://eightbar.eu-gb.mybluemix.net/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="https://eightbar.eu-gb.mybluemix.net/wp-content/themes/twentyeleven/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel="alternate" type="application/rss+xml" title="eightbar &raquo; Feed" href="https://eightbar.eu-gb.mybluemix.net/feed/" />
<link rel="alternate" type="application/rss+xml" title="eightbar &raquo; Comments Feed" href="https://eightbar.eu-gb.mybluemix.net/comments/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"https:\/\/eightbar.eu-gb.mybluemix.net\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.5.3"}};
			!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;if(!g||!g.fillText)return!1;switch(g.textBaseline="top",g.font="600 32px Arial",a){case"flag":return g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3;case"diversity":return g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,d=c[0]+","+c[1]+","+c[2]+","+c[3],g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e;case"simple":return g.fillText(h(55357,56835),0,0),0!==g.getImageData(16,16,1,1).data[0];case"unicode8":return g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='dark-css'  href='https://eightbar.eu-gb.mybluemix.net/wp-content/themes/twentyeleven/colors/dark.css' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='https://eightbar.eu-gb.mybluemix.net/wp-content/plugins/jetpack/_inc/genericons/genericons/genericons.css?ver=3.1' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://eightbar.eu-gb.mybluemix.net/wp-content/plugins/jetpack/css/jetpack.css?ver=3.3.3' type='text/css' media='all' />
<script type='text/javascript' src='https://eightbar.eu-gb.mybluemix.net/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://eightbar.eu-gb.mybluemix.net/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='https://eightbar.eu-gb.mybluemix.net/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://eightbar.eu-gb.mybluemix.net/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://eightbar.eu-gb.mybluemix.net/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Hursley Celebration' href='https://eightbar.eu-gb.mybluemix.net/2012/05/31/hursley-celebration/' />
<link rel='next' title='Man vs Horse' href='https://eightbar.eu-gb.mybluemix.net/2012/09/29/man-vs-horse/' />
<meta name="generator" content="WordPress 4.5.3" />
<link rel='shortlink' href='http://wp.me/pBOPx-qC' />
<link rel="alternate" type="application/json+oembed" href="https://eightbar.eu-gb.mybluemix.net/wp-json/oembed/1.0/embed?url=http%3A%2F%2Feightbar.co.uk%2F2012%2F06%2F08%2Feven-more-mqtt-enabled-tvs-2%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://eightbar.eu-gb.mybluemix.net/wp-json/oembed/1.0/embed?url=http%3A%2F%2Feightbar.co.uk%2F2012%2F06%2F08%2Feven-more-mqtt-enabled-tvs-2%2F&#038;format=xml" />
	<style>
		/* Link color */
		a,
		#site-title a:focus,
		#site-title a:hover,
		#site-title a:active,
		.entry-title a:hover,
		.entry-title a:focus,
		.entry-title a:active,
		.widget_twentyeleven_ephemera .comments-link a:hover,
		section.recent-posts .other-recent-posts a[rel="bookmark"]:hover,
		section.recent-posts .other-recent-posts .comments-link a:hover,
		.format-image footer.entry-meta a:hover,
		#site-generator a:hover {
			color: #b4d1f3;
		}
		section.recent-posts .other-recent-posts .comments-link a:hover {
			border-color: #b4d1f3;
		}
		article.feature-image.small .entry-summary p a:hover,
		.entry-header .comments-link a:hover,
		.entry-header .comments-link a:focus,
		.entry-header .comments-link a:active,
		.feature-slider a.active {
			background-color: #b4d1f3;
		}
	</style>

<!-- All in One SEO Pack 2.2.4.1 by Michael Torbert of Semper Fi Web Design[355,399] -->
<meta name="description"  content="A project at work recently came up to do with using one of the Emotiv headsets to help out a former Italian IBMer who was suffering from locked in syndrome. The" />

<meta name="keywords"  content="8bar,eightbar,mqtt,projects,redrat,tv,work,planet" />

<link rel="canonical" href="https://eightbar.eu-gb.mybluemix.net/2012/06/08/even-more-mqtt-enabled-tvs-2/" />
<!-- /all in one seo pack -->
	<style type="text/css">
			#site-title,
		#site-description {
			position: absolute !important;
			clip: rect(1px 1px 1px 1px); /* IE6, IE7 */
			clip: rect(1px, 1px, 1px, 1px);
		}
		</style>
	<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #E3E3E3; }
</style>
</head>

<body class="single single-post postid-1650 single-format-standard custom-background singular two-column right-sidebar">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
			<hgroup>
				<h1 id="site-title"><span><a href="https://eightbar.eu-gb.mybluemix.net/" title="eightbar" rel="home">eightbar</a></span></h1>
				<h2 id="site-description">Raising The Eight Bar</h2>
			</hgroup>

						<a href="https://eightbar.eu-gb.mybluemix.net/">
									<img src="https://eightbar.eu-gb.mybluemix.net/wp-content/uploads/2012/02/eightbargrass.jpg" width="1000" height="288" alt="" />
							</a>
			
							<div class="only-search with-image">
					<form method="get" id="searchform" action="https://eightbar.eu-gb.mybluemix.net/">
		<label for="s" class="assistive-text">Search</label>
		<input type="text" class="field" name="s" id="s" placeholder="Search" />
		<input type="submit" class="submit" name="submit" id="searchsubmit" value="Search" />
	</form>
				</div>
			
			<nav id="access" role="navigation">
				<h3 class="assistive-text">Main menu</h3>
								<div class="skip-link"><a class="assistive-text" href="#content" title="Skip to primary content">Skip to primary content</a></div>
				<div class="skip-link"><a class="assistive-text" href="#secondary" title="Skip to secondary content">Skip to secondary content</a></div>
								<div class="menu-eightbar-main-menu-container"><ul id="menu-eightbar-main-menu" class="menu"><li id="menu-item-1192" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1192"><a href="https://eightbar.eu-gb.mybluemix.net/">Home</a></li>
<li id="menu-item-1193" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1193"><a href="https://eightbar.eu-gb.mybluemix.net/about/">About</a></li>
</ul></div>			</nav><!-- #access -->
	</header><!-- #branding -->


	<div id="main">

		<div id="primary">
			<div id="content" role="main">

				
					<nav id="nav-single">
						<h3 class="assistive-text">Post navigation</h3>
						<span class="nav-previous"><a href="https://eightbar.eu-gb.mybluemix.net/2012/05/31/hursley-celebration/" rel="prev"><span class="meta-nav">&larr;</span> Previous</a></span>
						<span class="nav-next"><a href="https://eightbar.eu-gb.mybluemix.net/2012/09/29/man-vs-horse/" rel="next">Next <span class="meta-nav">&rarr;</span></a></span>
					</nav><!-- #nav-single -->

					
<article id="post-1650" class="post-1650 post type-post status-publish format-standard hentry category-planet tag-8bar tag-eightbar tag-mqtt tag-projects tag-redrat tag-tv tag-work">
	<header class="entry-header">
		<h1 class="entry-title">Even More MQTT enabled TVs</h1>

				<div class="entry-meta">
			<span class="sep">Posted on </span><a href="https://eightbar.eu-gb.mybluemix.net/2012/06/08/even-more-mqtt-enabled-tvs-2/" title="15:17" rel="bookmark"><time class="entry-date" datetime="2012-06-08T15:17:57+00:00">June 8, 2012</time></a><span class="by-author"> <span class="sep"> by </span> <span class="author vcard"><a class="url fn n" href="https://eightbar.eu-gb.mybluemix.net/author/hardillb/" title="View all posts by Ben Hardill" rel="author">Ben Hardill</a></span></span>		</div><!-- .entry-meta -->
			</header><!-- .entry-header -->

	<div class="entry-content">
		<p><a class="alignright" title="Kevin with the Headset by shawdm, on Flickr" href="http://www.flickr.com/photos/shawdm/4652324438/"><img src="http://farm5.staticflickr.com/4050/4652324438_2e5e0cab06_n.jpg" alt="Kevin Modelling the headset" width="320" height="213" /></a></p>
<p>A project at work recently came up to do with using one of the <a href="http://emotiv.com/">Emotiv</a> headsets to help out a former Italian IBMer who was suffering from <a href="http://en.wikipedia.org/wiki/Locked-in_syndrome">locked in syndrome</a>. The project was being led by <a href="http://kevinxbrown.blogspot.com/">Kevin Brown</a> who was looking for ways to use the headset to drive things sending email and browsing the web but he was also looking for a way to interact with some other tech around the house. The TV was the first on the list.</p>
<p>Continuing on from my previous work with <a href="http://www.hardill.me.uk/wordpress/?p=25">controlling TVs</a> and <a href="https://eightbar.eu-gb.mybluemix.net/2011/09/16/mqtt-powered-video-wall/">video walls</a> with <a href="http://mqtt.org/">MQTT</a> I said I would have a crack at this. My earlier solution was limited to LG TVs with serial ports and this needed to work with any make so a different approach was needed. It also needed to run on Windows so it was also a chance to play with C# and .Net.</p>
<p>To be TV agnostic it was decided to use a USB IR remote from a company called <a href="http://www.redrat.co.uk/index.html">RedRat</a>. They make a number of solutions, but their RedRat III was perfect for what was needed.</p>
<p><a class="alignleft" title="RedRat IR transmitter &amp; receiver by hardillb, on Flickr" href="http://www.flickr.com/photos/hardillb/7136002505/"><img src="http://farm8.staticflickr.com/7066/7136002505_cbfced5a8a_n.jpg" alt="RedRat IR transmitter &amp; receiver" width="240" height="320" /></a></p>
<p>The <a href="http://www.redrat.co.uk/software/SDK/index.html">RedRat API</a> comes with bindings for C++, .Net on Windows (and a <a href="http://www.lirc.org/">LIRC</a> plugin for Linux). The RedRat III is not just a IR transmitter, it is also a receiver which means it can &#8220;learn&#8221; from existing remote controls so it can be used with any TV.</p>
<p>Kevin is using Emotiv headset to drive <a href="http://www.inference.phy.cam.ac.uk/dasher/">Dasher</a> as the input device. Dasher is a sort of keyboard replacement that allows the user to build up words using at a minimum a single input e.g. a single push button. As well as building words other actions can be added to the selector, Kevin added actions for browsing and also to control the TV. These actions publish MQTT messages to a topic with payloads like &#8220;volUp&#8221;, &#8220;chanDown&#8221; or &#8220;power&#8221;.</p>
<p>So now we had the inputs it was time to get round to writing the code to turn those messages into IR signals. There are 2 MQTT .NET libraries listed on the MQTT.org software page. I grabbed the first off the list <a href="http://sourceforge.net/projects/mqttdotnet/">MqttDotNet</a> and got things working pretty quickly.</p>
<p>The following few lines sets up a connection and subscribes to a topic.</p>
<pre class="brush: csharp; gutter: true">String connectionString = &quot;tcp://&quot; + 
  Properties.Settings.Default.host.Trim() + &quot;:&quot; +
  Properties.Settings.Default.port;
IMqtt client = MqttClientFactory.CreateClient(connectionString, &quot;mqtt2ir&quot;);
try
{
	client.Connect(true);
	client.PublishArrived += new PublishArrivedDelegate(onMessage);
	client.ConnectionLost += new ConnectionDelegate(connectionLost);
	client.Subscribe(Properties.Settings.Default.topic.Trim(), 
	  QoS.BestEfforts);
}</pre>
<p>Where the onMessage callback looks like this:</p>
<pre class="brush: csharp; gutter: true">bool onMessage(object sender, PublishArrivedArgs msg)
{
	String command = msg.Payload.ToString().Trim();
	IRPacket packet = loadSignal(command);
	if (packet != null) 
	{
		redrat.OutputModulatedSignal(packet);
	}
	return true;
}</pre>
<p><a href="http://www.hardill.me.uk/wordpress/wp-content/uploads/2012/06/MQTT2IR.png"><img class="alignright size-medium wp-image-986" title="MQTT2IR Settings Window" src="http://www.hardill.me.uk/wordpress/wp-content/uploads/2012/06/MQTT2IR.png" alt="MQTT2IR Settings Window" width="300" height="249" /></a></p>
<p>And that is pretty much the meat of the whole application, the rest was just some code to initialise the RedRat and to turn it into a System Tray application with a window for entering the broker details and training the commands.</p>
<p>Unfortunately just a few days before we were due to have delivered this project we learned that the intended recipient had picked up a respiratory infection and had passed away. I would like to extend my thoughts to their family and I hope we can find somebody who may find this work useful in the future.</p>
			</div><!-- .entry-content -->

	<footer class="entry-meta">
		<p>This is a <a href="http://www.hardill.me.uk/wordpress/2012/06/08/even-more-mqtt-enabled-tvs/">syndicated entry</a> please make comments on the original post.</p>This entry was posted in <a href="https://eightbar.eu-gb.mybluemix.net/category/planet/" rel="category tag">Planet</a> and tagged <a href="https://eightbar.eu-gb.mybluemix.net/tag/8bar/" rel="tag">8bar</a>, <a href="https://eightbar.eu-gb.mybluemix.net/tag/eightbar/" rel="tag">eightbar</a>, <a href="https://eightbar.eu-gb.mybluemix.net/tag/mqtt/" rel="tag">MQTT</a>, <a href="https://eightbar.eu-gb.mybluemix.net/tag/projects/" rel="tag">Projects</a>, <a href="https://eightbar.eu-gb.mybluemix.net/tag/redrat/" rel="tag">redrat</a>, <a href="https://eightbar.eu-gb.mybluemix.net/tag/tv/" rel="tag">TV</a>, <a href="https://eightbar.eu-gb.mybluemix.net/tag/work/" rel="tag">Work</a> by <a href="https://eightbar.eu-gb.mybluemix.net/author/hardillb/">Ben Hardill</a>. Bookmark the <a href="https://eightbar.eu-gb.mybluemix.net/2012/06/08/even-more-mqtt-enabled-tvs-2/" title="Permalink to Even More MQTT enabled TVs" rel="bookmark">permalink</a>.		
			</footer><!-- .entry-meta -->
</article><!-- #post-1650 -->
						<div id="comments">
	
	
	
	
</div><!-- #comments -->

				
			</div><!-- #content -->
		</div><!-- #primary -->


	</div><!-- #main -->

	<footer id="colophon" role="contentinfo">

			

			<div id="site-generator">
								<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress</a>
			</div>
	</footer><!-- #colophon -->
</div><!-- #page -->

	<div style="display:none">
	</div>

	<script type="text/javascript">
		WPCOM_sharing_counts = {"https:\/\/eightbar.eu-gb.mybluemix.net\/2012\/06\/08\/even-more-mqtt-enabled-tvs-2\/":1650}	</script>
		<script type="text/javascript">
		jQuery(document).on( 'ready post-load', function(){
			jQuery( 'a.share-google-plus-1' ).on( 'click', function() {
				window.open( jQuery(this).attr( 'href' ), 'wpcomgoogle-plus-1', 'menubar=1,resizable=1,width=480,height=550' );
				return false;
			});
		});
		</script>
				<script type="text/javascript">
		jQuery(document).on( 'ready post-load', function(){
			jQuery( 'a.share-twitter' ).on( 'click', function() {
				window.open( jQuery(this).attr( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
				return false;
			});
		});
		</script>
				<script type="text/javascript">
		jQuery(document).on( 'ready post-load', function(){
			jQuery( 'a.share-facebook' ).on( 'click', function() {
				window.open( jQuery(this).attr( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
				return false;
			});
		});
		</script>
			<div id="sharing_email" style="display: none;">
		<form action="https://eightbar.eu-gb.mybluemix.net/2012/06/08/even-more-mqtt-enabled-tvs-2/" method="post">
			<label for="target_email">Send to Email Address</label>
			<input type="email" name="target_email" id="target_email" value="" />

			
				<label for="source_name">Your Name</label>
				<input type="text" name="source_name" id="source_name" value="" />

				<label for="source_email">Your Email Address</label>
				<input type="email" name="source_email" id="source_email" value="" />

			
			
			<img style="float: right; display: none" class="loading" src="https://eightbar.eu-gb.mybluemix.net/wp-content/plugins/jetpack/modules/sharedaddy/images/loading.gif" alt="loading" width="16" height="16" />
			<input type="submit" value="Send Email" class="sharing_send" />
			<a href="#cancel" class="sharing_cancel">Cancel</a>

			<div class="errors errors-1" style="display: none;">
				Post was not sent - check your email addresses!			</div>

			<div class="errors errors-2" style="display: none;">
				Email check failed, please try again			</div>

			<div class="errors errors-3" style="display: none;">
				Sorry, your blog cannot share posts by email.			</div>
		</form>
	</div>
		<script type="text/javascript">
		jQuery(document).on( 'ready post-load', function(){
			jQuery( 'a.share-linkedin' ).on( 'click', function() {
				window.open( jQuery(this).attr( 'href' ), 'wpcomlinkedin', 'menubar=1,resizable=1,width=580,height=450' );
				return false;
			});
		});
		</script>
		<script type='text/javascript' src='https://eightbar.eu-gb.mybluemix.net/wp-includes/js/comment-reply.min.js?ver=4.5.3'></script>
<script type='text/javascript' src='http://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201630'></script>
<script type='text/javascript' src='http://s.gravatar.com/js/gprofiles.js?ver=2016Julaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://eightbar.eu-gb.mybluemix.net/wp-content/plugins/jetpack/modules/wpgroho.js?ver=4.5.3'></script>
<script type='text/javascript' src='https://eightbar.eu-gb.mybluemix.net/wp-includes/js/wp-embed.min.js?ver=4.5.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='https://eightbar.eu-gb.mybluemix.net/wp-content/plugins/jetpack/modules/sharedaddy/sharing.js?ver=3.3.3'></script>

	<script src="http://stats.wp.com/e-201630.js" type="text/javascript"></script>
	<script type="text/javascript">
	st_go({v:'ext',j:'1:3.3.3',blog:'9013531',post:'1650',tz:'1'});
	var load_cmc = function(){linktracker_init(9013531,1650,2);};
	if ( typeof addLoadEvent != 'undefined' ) addLoadEvent(load_cmc);
	else load_cmc();
	</script>
</body>
</html>